{% extends "base.html" %}

{% block title %}Generate Campaign - Creative Automation Pipeline{% endblock %}

{% block content %}
<div class="hero">
    <h2>Generate Campaign Creatives</h2>
    <p>AI-powered image generation for Werkr marketing campaigns</p>
    <div style="margin-top: 1.5rem;">
        <img src="{{ url_for('assets', path='werkr_brand_image.png') }}" alt="Werkr Logo" style="height:64px;">
    </div>
    <div style="margin-top: 1rem; color: green; font-weight: bold;">
        [CONFIRMATION: This message is displaying on frontend]
    </div>
</div>

<div class="form-container">
    <form id="campaignForm">
        <div class="form-group">
            <label for="products">Products *</label>
            <input type="text" id="products" name="products" 
                   placeholder="e.g., Running Shoes, Athletic Wear" required>
            <small>Comma-separated list of products</small>
        </div>

        <div class="form-row">
        <div class="form-group">
            <label for="region">Country/Region *</label>
            <div class="country-selector">
                <input type="text" id="regionSearch" placeholder="Search countries..." autocomplete="off">
                <div id="regionDropdown" class="country-dropdown" style="display: none;">
                    <!-- Countries will be loaded dynamically -->
                </div>
                <input type="hidden" id="region" name="region" required>
                <div id="selectedCountry" class="selected-country" style="display: none;">
                    <span id="selectedCountryName"></span>
                    <button type="button" id="clearCountry" class="clear-btn">×</button>
                </div>
            </div>
            <small>Start typing to search countries</small>
        </div>

            <div class="form-group">
                <label for="audience">Target Audience *</label>
                <div class="audience-selector">
                    <input type="text" id="audienceSearch" placeholder="Search audiences..." autocomplete="off">
                    <div id="audienceDropdown" class="audience-dropdown" style="display: none;">
                        <!-- Audiences will be loaded dynamically -->
                    </div>
                    <input type="hidden" id="audience" name="audience" required>
                    <div id="selectedAudience" class="selected-audience" style="display: none;">
                        <span id="selectedAudienceName"></span>
                        <button type="button" id="clearAudience" class="clear-btn">×</button>
                    </div>
                </div>
                <small>Start typing to search audiences</small>
            </div>
        </div>

        <div class="form-group">
            <label for="message">Campaign Message *</label>
            <textarea id="message" name="message" rows="4" 
                      placeholder="e.g., Professional athlete running at sunset with determination and strength" required></textarea>
            <small>Be descriptive - this generates your images</small>
        </div>

        <button type="submit" id="submitBtn" class="btn-primary">
            <span class="btn-text">Generate Campaign</span>
            <span class="btn-loader" style="display: none;">⏳ Generating...</span>
        </button>
    </form>
</div>

<div id="results" class="results-container" style="display: none;">
    <h3>✅ Campaign Generated!</h3>
    
    <div class="campaign-info">
        <p><strong>Campaign ID:</strong> <code id="campaignId"></code></p>
        <p><strong>Compliance:</strong> <span id="complianceStatus"></span></p>
        <p><strong>Products:</strong> <span id="productCount"></span></p>
        <p><strong>Region:</strong> <span id="campaignRegion"></span></p>
        <p><strong>Message:</strong> <span id="campaignMessage"></span></p>
    </div>

    <div id="productsContainer">
        <!-- Products will be dynamically added here -->
    </div>

    <button onclick="location.reload()" class="btn-secondary">Generate Another</button>
</div>

<div id="error" class="error-container" style="display: none;">
    <h3>❌ Error</h3>
    <p id="errorMessage"></p>
    <button onclick="hideError()" class="btn-secondary">Try Again</button>
</div>
{% endblock %}

